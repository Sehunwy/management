<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="icon" href="../assets/img/bitbug_favicon.ico" type="img/x-ico"/>
    <title>四川工商学院毕业设计管理系统登录界面</title>
    <!-- 自定义 Styles-->
    <link href="../assets/css/login.css" rel="stylesheet"/>
    <!-- Bootstrap Styles-->
    <link href="../assets/css/bootstrap.css" rel="stylesheet"/>
    <!-- 字体图标 Styles-->
    <link href="../assets/css/iconfont.css" rel="stylesheet"/>
</head>
<body>
<div class="container">
    <div id="content">
        <ul class="tab_menu">
            <li class="selected">账户密码登录</li>
            <li>手机号登录</li>
        </ul>
        <div class="horizontal"></div>
        <div id="type0" class="row type">
            <div class="col-md-12">
                <div class="col-md-1">
                </div>
                <div class="col-md-10">
                    <div class="form-group has-success">
                        <span class="iconfont icon-wode iconFont"></span>
                        <input id="username" type="text" class="form-control" placeholder="请输入学号（工号）" autofocus
                               required>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-10">
                    <div class="form-group has-success">
                        <span class="iconfont icon-mima iconFont"></span>
                        <input id="password" type="password" class="form-control" placeholder="请输入密码" required>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-5">
                    <div class="form-group has-success">
                        <span class="iconfont icon-ERP_yanzhengma iconFont"></span>
                        <input id="inputCode" type="text" class="form-control" placeholder="请输入验证码" required>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-group has-success">
                        <img style="cursor: pointer" id="code"
                             src="http://www.yuanbw.cn:20086/gpms/code/getVerifyCode?width=100&height=40"
                             onclick="javascript:document.getElementById('code').src='http://www.yuanbw.cn:20086/gpms/code/getVerifyCode?width=100&height=40&'+Math.random()">
                        <!--<canvas id="identify" style="cursor: pointer"></canvas>-->
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-2 padding0">
                    <label><input name="category" type="radio" value="1" checked/>学生 </label>
                </div>
                <div class="col-md-4 padding0">
                    <label><input name="category" type="radio" value="2"/>教师/系主任 </label>
                </div>
                <div class="col-md-2 padding0">
                    <label><input name="category" type="radio" value="4"/>管理员 </label>
                </div>
            </div>
            <div style="padding-bottom: 20px" class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-3">
                    <button type="button" class="btn btn-sm btn-info" onclick="Login()">登录</button>
                </div>
                <div class="col-md-4"></div>
                <div style="line-height: 30px;height: 30px" class="col-md-3">
                    <a href="#">忘记密码?</a>
                </div>
            </div>
        </div>
        <div id="type1" class="row type hide">
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-10">
                    <div class="form-group has-success">
                        <span class="iconfont icon-gerenxinxiyedianhuahaoma iconFont"></span>
                        <input type="text" class="form-control" placeholder="请输入电话号码" autofocus required>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-5">
                    <div class="form-group has-success">
                        <span class="iconfont icon-ERP_yanzhengma iconFont"></span>
                        <input type="text" class="form-control" placeholder="请输入验证码" required>
                    </div>
                </div>
                <div class="col-md-5">

                    <button id="btn" type="button" class="btn btn-info">获取验证码</button>
                </div>
            </div>
            <div style="padding-bottom: 20px" class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-3">
                    <button type="button" class="btn btn-sm btn-info">登录</button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- jQuery Js -->
<script src="../assets/js/jquery-1.10.2.js"></script>
<script>
    function Login() {
        let username = document.getElementById('username').value;
        let password = document.getElementById('password').value;
        let inputCode = document.getElementById('inputCode').value;
        let radios = document.getElementsByName("category");
        let value = 1;
        for (let i = 0; i < radios.length; i++) {
            if (radios[i].checked == true) {
                value = radios[i].value;
            }
        }
        let url = "http://www.yuanbw.cn:20086/gpms/rol/idlogin";
        $.ajax({
            url: url,
            type: "POST",
            data: {
                id: username,
                password: password,
                roleType: value,
                code: inputCode
            },
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function (responseStr) {
                let msg = responseStr.msg;
                console.log("success");
                if (msg == "登录成功") {
                    let authority = responseStr.data.authority;
                    console.log(authority);
                    if (authority == 1) {
                        window.location.href = "../student/studentIndex.html";
                    }
                    else if(authority == 2) {
                        window.location.href = "../teacher/teacherIndex.html";
                    }
                    else if(authority == 3) {
                        window.location.href = "../dean/deanIndex.html";
                    }
                    else if(authority == 4) {
                        window.location.href = "../admin/adminIndex.html";
                    }
                } else {
                    alert(msg);
                }

            },
            error: function (responseStr) {
                console.log("failed");
                console.log(responseStr);
            }
        });
    }
</script>

<script type="text/javascript">
    $(document).ready(function () {
        let $tab_li = $('#content ul li');
        $tab_li.click(function () {
            console.log(111);
            $(this).addClass('selected').siblings().removeClass('selected');
            let index = $tab_li.index(this);
            $('.type').addClass('hide');
            $('#type' + index).removeClass('hide');
        });
    });
</script>

<script>
    let wait = 60;
    document.getElementById("btn").onclick = function () {
        time(this);
    }

    function time(o) {
        if (wait == 0) {
            o.removeAttribute("disabled");
            o.innerHTML = "获取验证码";
            wait = 60;
        } else {
            o.setAttribute("disabled", true);
            o.innerHTML = wait + "秒后重新发送";
            wait--;
            setTimeout(function () {
                time(o)
            }, 1000)
        }
    }
</script>

</body>
</html>