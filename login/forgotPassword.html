<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="icon" href="../assets/img/bitbug_favicon.ico" type="img/x-ico"/>
    <title>四川工商学院毕业设计管理系统忘记密码界面</title>
    <!-- 自定义 Styles-->
    <link href="../assets/css/login.css" rel="stylesheet"/>
    <!-- Bootstrap Styles-->
    <link href="../assets/css/bootstrap.css" rel="stylesheet"/>
    <!-- 字体图标 Styles-->
    <link href="../assets/css/iconfont.css" rel="stylesheet"/>
</head>
<body>
<div class="container">
    <div id="content">
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-4"><h4 style="color: #049ec4">找回密码</h4></div>
            </div>
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-10">
                    <div class="form-group has-info" id="telNumberParent">
                        <span class="iconfont icon-gerenxinxiyedianhuahaoma iconFont"></span>
                        <input id="telNumber" type="text" class="form-control" placeholder="请输入电话号码" autofocus>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-5">
                    <div class="form-group has-info" id="telCodeParent">
                        <span class="iconfont icon-ERP_yanzhengma iconFont"></span>
                        <input id="telCode" type="text" class="form-control" placeholder="请输入验证码">
                    </div>
                </div>
                <div class="col-md-5">
                    <button id="btn" type="button" class="btn btn-info" onclick="getPhoneCode()">获取验证码</button>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-10">
                    <div class="form-group has-info" id="newPasswordParent">
                        <span class="iconfont icon-mima iconFont"></span>
                        <input id="newPassword" type="text" class="form-control" placeholder="请输入新密码">
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-10">
                    <div class="form-group has-info" id="confirmNewPasswordParent">
                        <span class="iconfont icon-mima iconFont"></span>
                        <input id="confirmNewPassword" type="text" class="form-control" placeholder="请确认新密码">
                    </div>
                </div>
            </div>
            <div style="padding-bottom: 20px" class="col-md-12">
                <div class="col-md-1"></div>
                <div class="col-md-3">
                    <button type="button" class="btn btn-sm btn-success">确定</button>
                </div>
                <div class="col-md-4"></div>
                <div class="col-md-3">
                    <button type="button" class="btn btn-sm btn-info">
                        <a href="./login.html" style="color: #fff;text-decoration:none; ">返回</a>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- jQuery Js -->
<script src="../assets/js/jquery-1.10.2.js"></script>
<!-- Bootstrap Js -->
<script src="../assets/js/bootstrap.js"></script>
<!-- 自定义函数 Js -->
<script src="../assets/js/commonFunction.js"></script>

<script>

    function classChange(id, oldClass, newClass) {
        $('#' + id).addClass(newClass);
        $('#' + id).removeClass(oldClass);
    }

    function passwordPopover(newPassword, newPasswordPrent) {
        let password = document.getElementById(newPassword);
        let passwordValue = document.getElementById(newPassword).value;
        let length = passwordValue.length;
        if (passwordValue == '') {
            password.setAttribute('data-content', "密码不能为空");
            classChange(newPasswordPrent, 'has-info', 'has-error');
        } else if (length < 6 || length > 16) {
            password.setAttribute('data-content', "密码长度为6-16位");
            classChange(newPasswordPrent, 'has-info', 'has-error');
        } else {
            password.setAttribute('data-content', "");
            classChange(newPasswordPrent, 'has-error', 'has-info');
        }
    }

    function inputCodePopover(code, codePrent) {
        let inputCode = document.getElementById(code);
        let inputCodeValue = document.getElementById(code).value;
        if (inputCodeValue == '') {
            inputCode.setAttribute('data-content', "验证码不能为空");
            classChange(codePrent, 'has-info', 'has-error');
        } else {
            inputCode.setAttribute('data-content', "");
            classChange(codePrent, 'has-error', 'has-info');
        }
    }

    function telNumberPopover(telNumber, telNumberParent) {
        let tel = document.getElementById(telNumber);
        let telValue = document.getElementById(telNumber).value;
        if (telValue == '') {
            tel.setAttribute('data-content', "手机号不能为空");
            classChange(telNumberParent, 'has-info', 'has-error');
        } else if (!(/^1[34578]\d{9}$/.test(telValue))) {
            tel.setAttribute('data-content', "手机号码有误，请重填");
            classChange(telNumberParent, 'has-info', 'has-error');
            // confirmNewPasswordParent
        } else {
            tel.setAttribute('data-content', "");
            classChange(telNumberParent, 'has-error', 'has-info');
        }
    }

    function popover(id) {
        $('#' + id).popover({
            trigger: 'manual'
        })
            .on('focus', function () {
// 获得焦点时隐藏
                classChange(id + "Parent", 'has-error', 'has-info');
                $(this).popover('hide');
            })
            .on('blur', function () {
                if (id == "confirmNewPassword") {
                    passwordPopover('confirmNewPassword', 'confirmNewPasswordParent');
                } else if (id == "newPassword") {
                    passwordPopover('newPassword', 'newPasswordParent');
                } else if (id == "telCode") {
                    inputCodePopover('telCode', 'telCodeParent');
                } else if (id == "telNumber") {
                    telNumberPopover('telNumber', 'telNumberParent');
                }
// 失去焦点时显示
                $(this).popover('show');
            });
    }

    $(function () {
// 初始化 popover，触发方式为手动触发
        popover("newPassword");
        popover("confirmNewPassword");
        popover("telCode");
        popover("telNumber");
    });
</script>

<!--手机登录-->
<script>
    let wait = 60;
    let code;
    let telNumber = 0;

    function time(o) {
        if (wait == 0) {
            o.removeAttribute("disabled");
            o.innerHTML = "获取验证码";
            wait = 60;
        } else {
            o.setAttribute("disabled", true);
            o.innerHTML = wait + "秒后重新发送";
            wait--;
            setTimeout(function () {
                time(o)
            }, 1000)
        }
    }

    function getPhoneCode() {
        let btn = document.getElementById("btn");
        time(btn);
        let url = "http://www.yuanbw.cn:20086/gpms/rol/sendBindCode";
        telNumber = document.getElementById('telNumber').value;
        $.ajax({
            url: url,
            type: "POST",
            data: {
                tel: telNumber
            },
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            success: function (responseStr) {
            },
            error: function (responseStr) {
                window.location.href = "../404/404.html";
            }
        });
    }
</script>

</body>
</html>